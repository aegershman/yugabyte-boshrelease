#!/bin/bash

set -e -u

# detect number of CPUs so "make" jobs can be parallelized
CPUS=$(grep -c ^processor /proc/cpuinfo)

tar xf python/Python-3.8.1.tgz
pushd Python-3.8.1
./configure \
  --prefix=${BOSH_INSTALL_TARGET} \
  --with-ensurepip \
  --enable-shared \
  --enable-ipv6 \
  --enable-unicode=ucs4

make -j ${CPUS}
make install
popd

for dir in $(ls -d /var/vcap/packages/*/bin); do export PATH=$dir:$PATH; done
for dir in $(ls -d /var/vcap/packages/*/lib); do export LD_LIBRARY_PATH=$dir:${LD_LIBRARY_PATH:-}; done
