#!/usr/bin/env bash

set -eu

<%
m = link("yb-master")
master_addresses = m.instances.map { |i| "#{i.address}:#{m.p('server_broadcast_addresses_port')}" }.join(",")
%>

<% p("commands", []).each do |command| %>
echo "executing command: <%= command %>"
/var/vcap/packages/yugabyte/bin/yb-admin \
  -master_addresses <%= master_addresses %> \
  -timeout_ms <%= p('timeout_ms') %> \
  <% if p("tls.enabled") %> \
  -certs_dir_name /var/vcap/jobs/yb-admin/config/certs \
  <% end %> \
  <%= command %>
<% end %>
