---
name: yb-tserver

description: |
  https://docs.yugabyte.com/latest/reference/configuration/yb-tserver/

templates:
  bin/cert-linker.erb.sh: bin/cert-linker.sh
  bin/post-deploy.sh: bin/post-deploy
  bin/post-start.sh.erb: bin/post-start
  bin/pre-start.sh: bin/pre-start
  config/bpm.erb.yml: config/bpm.yml
  config/certs/ca.crt.erb: config/certs/ca.crt
  config/certs/node.crt.erb: config/certs/node.crt
  config/certs/node.key.erb: config/certs/node.key
  config/cqlshrc.erb: config/cqlshrc
  config/roles.cql.erb: config/roles.cql
  config/tserver.conf.erb: config/tserver.conf

packages:
  - python-2.7
  - yugabyte

consumes:
  - name: yb-master
    type: yb-master-address-link

provides:
  - name: yb-tserver
    type: yb-tserver-address-link

properties:
  bpm.limits.open_files:
    default: 64000
  bpm.limits.processes:
    default: 64000
  rpc_bind_addresses_port:
    description: for the time being, this value is used for both "rpc_bind_addresses" and "server_broadcast_addresses"
    default: 9100
  post_start_delay:
    description: |
      time delay in seconds to wait after startup before the lifecycle reports healthy,
      i.e., after the yugabyte process reports healthy, then wait an additional
      "post_start_delay"-seconds before BOSH marks the lifecycle as complete.
      this is helpful for giving some slack to yugabyte processes to give some
      extra time to join quorum and such. this is currently being set based off of the guidance of
      yugabyte's "upgrade-deployment" documentation, and thus erring on the side of cautious.
      but if you wanted you could set this to 0 and just see what happens. if you do that,
      please let us know how it works out and if you see any problems.
      until then, the default will be the recommended 60 seconds.
      see also: https://docs.yugabyte.com/latest/manage/upgrade-deployment
    default: 60

  tls.allow_insecure_connections:
    description: |
      set to false to disallow any client with unencrypted communication from joining this cluster. default value is true.
      note that this option requires --use_client_to_server_encryption to be enabled.
      see also: https://docs.yugabyte.com/latest/secure/tls-encryption/client-to-server
    default: true
  tls.use_client_to_server_encryption:
    description: |
      set to true to enable encryption between clients and cluster
      see also: https://docs.yugabyte.com/latest/secure/tls-encryption/client-to-server
    default: false
  tls.use_node_to_node_encryption:
    description: |
      set to true to enable encryption between nodes
      see also: https://docs.yugabyte.com/latest/secure/tls-encryption/server-certificates
    default: false
  tls.node.ca:
    description: "CA root required for key/cert verification"
  tls.node.cert:
    description: "TLS certificate for this node"
  tls.node.key:
    description: "TLS key for this node"

  gflags:
    description: extra "--key=value" properties to pass to the conf file
    example: |
      gflags:
        default_memory_limit_to_ram_ratio: 0.85
        placement_cloud: aws
        placement_region: us-west-2
  ycql.databases.superusers:
    description: |
      until we get to putting a more fine-grained RBAC model in place
      on startup, we'll just assume every created user is a superuser
      https://docs.yugabyte.com/latest/api/ycql/ddl_alter_role/
    example: |
      ycql:
        databases:
          superusers:
            - name: hank_hill
              password: propane_bwaaah

  max_log_size:
    description: "The maximum log size, in megabytes (MB). A value of 0 will be silently overridden to 1."
    default: 1800 # 1.8 GB
  minloglevel:
    description: "The minimum level to log messages. Values are: 0 (INFO), 1 (WARN), 2 (ERROR), 3 (FATAL)."
    default: 0
  stderrthreshold:
    description: |
      Log messages at, or above, this level are copied to stderr in addition to log files.
      Values are: 0 (INFO), 1 (WARN), 2 (ERROR), 3 (FATAL).
      By setting this to "0" by default, it tees error logs to both the log file directory and stderr.
    default: 0
  stop_logging_if_full_disk:
    description: Stop attempting to log to disk if the disk is full.
    default: true
  v:
    description: "Yugabyte process log verbosity level. Values are: 0 (lowest), 1, 2, 3, 4 (highest)"
    default: 0
