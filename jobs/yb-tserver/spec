---
name: yb-tserver

description: |
  https://docs.yugabyte.com/latest/reference/configuration/yb-tserver/

templates:
  bin/cert-linker.erb.sh: bin/cert-linker.sh
  bin/post-deploy.sh: bin/post-deploy
  bin/pre-start.sh: bin/pre-start
  config/bpm.erb.yml: config/bpm.yml
  config/certs/ca.crt.erb: config/certs/ca.crt
  config/certs/node.crt.erb: config/certs/node.crt
  config/certs/node.key.erb: config/certs/node.key
  config/cqlshrc.erb: config/cqlshrc
  config/roles.cql.erb: config/roles.cql
  config/tserver.conf.erb: config/tserver.conf

packages:
  - python-2.7
  - yugabyte

consumes:
  - name: yb-master
    type: conn

provides:
  - name: yb-tserver
    type: conn

properties:
  bpm.limits.open_files:
    default: 64000
  bpm.limits.processes:
    default: 64000
  rpc_bind_addresses_port:
    default: 9100
  server_broadcast_addresses_port:
    default: 9100

  tls.use_node_to_node_encryption:
    description: |
      set to true to enable encryption between nodes
      see also: https://docs.yugabyte.com/latest/secure/tls-encryption/server-certificates
    default: false
  tls.node.ca:
    description: "CA root required for key/cert verification"
  tls.node.cert:
    description: "TLS certificate for this node"
  tls.node.key:
    description: "TLS key for this node"

  gflags:
    description: extra "--key=value" properties to pass to the conf file
    example: |
      gflags:
        default_memory_limit_to_ram_ratio: 0.85
        max_log_size: 256
        minloglevel: 0
        placement_cloud: aws
        placement_region: us-west-2
        stderrthreshold: 2
        stop_logging_if_full_disk: true
  ycql.databases.superusers:
    description: |
      until we get to putting a more fine-grained RBAC model in place
      on startup, we'll just assume every created user is a superuser
      https://docs.yugabyte.com/latest/api/ycql/ddl_alter_role/
    example: |
      ycql:
        databases:
          superusers:
            - name: hank_hill
              password: propane_bwaaah
